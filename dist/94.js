"use strict";(self.webpackChunksleact_ts_front=self.webpackChunksleact_ts_front||[]).push([[94],{83094:(e,n,t)=>{t.r(n),t.d(n,{default:()=>C});var r,l,o,a=t(42867),c=t(67294),i=t(66182),u=t.n(i),s=t(95591),f=t(44593),d=t(83564),p=t(5996);function h(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}var m=p.Z.div(r||(r=h(["\n  display: flex;\n  flex-wrap: wrap;\n  height: calc(100vh - 38px);\n  flex-flow: column;\n  position: relative;\n"]))),v=p.Z.header(l||(l=h(["\n  height: 64px;\n  display: flex;\n  width: 100%;\n  --saf-0: rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);\n  box-shadow: 0 1px 0 var(--saf-0);\n  padding: 20px 16px 20px 20px;\n  font-weight: bold;\n  align-items: center;\n  & img {\n    margin-right: 5px;\n  }\n"]))),g=(p.Z.div(o||(o=h(["\n  position: absolute;\n  top: 64px;\n  left: 0;\n  width: 100%;\n  height: calc(100% - 64px);\n  background: white;\n  opacity: 0.7;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 40px;\n"]))),t(5977)),b=t(92309),y=t(32545),w=t(38678),x=t(9669),Z=t.n(x),k=t(18667),S=t(32951);function E(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var r,l,o,a,c=[],i=!0,u=!1;try{if(o=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;i=!1}else for(;!(i=(r=o.call(t)).done)&&(c.push(r.value),c.length!==n);i=!0);}catch(e){u=!0,l=e}finally{try{if(!i&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(u)throw l}}return c}}(e,n)||function(e,n){if(e){if("string"==typeof e)return j(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?j(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,r=new Array(n);t<n;t++)r[t]=e[t];return r}const C=function(){var e,n,t=(0,g.UO)(),r=t.workspace,l=t.id,o=(0,s.ZP)("api/workspaces/".concat(r,"/users/").concat(l),d.Z).data,i=(0,s.ZP)("api/users",d.Z).data,p=E((0,w.Z)(""),3),h=p[0],x=p[1],j=p[2],C=(0,f.ZP)((function(e){return"/api/workspaces/".concat(r,"/dms/").concat(l,"/chats?perPage=20&page=").concat(e+1)}),d.Z),O=C.data,T=C.mutate,A=C.setSize,I=E((0,S.Z)(r),1)[0],_=0===(null==O||null===(e=O[0])||void 0===e?void 0:e.length)||O&&(null===(n=O[O.length-1])||void 0===n?void 0:n.length)<20||!1,z=(0,c.useRef)(null),P=(0,c.useCallback)((function(e){if(e.preventDefault(),console.log(h),null!=h&&h.trim()&&O){var n=h;T((function(e){var t;return null==e||e[0].unshift({id:((null===(t=O[0][0])||void 0===t?void 0:t.id)||0)+1,content:n,SenderId:i.id,Sender:i,ReceiverId:o.id,Receiver:o,createdAt:new Date}),e}),!1).then((function(){var e;j(""),null===(e=z.current)||void 0===e||e.scrollToBottom()})),Z().post("/api/workspaces/".concat(r,"/dms/").concat(l,"/chats"),{content:h}).then((function(){T()})).catch(console.error)}}),[h,O,i,o,r,l]),B=(0,c.useCallback)((function(e){e.SenderId===Number(l)&&i.id!==Number(l)&&T((function(n){return null==n||n[0].unshift(e),n}),!1).then((function(){var e;z.current&&z.current.getScrollHeight()<z.current.getClientHeight()+z.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=z.current)||void 0===e?void 0:e.getValues()),setTimeout((function(){var e;null===(e=z.current)||void 0===e||e.scrollToBottom()}),50))}))}),[]);if((0,c.useEffect)((function(){return null==I||I.on("dm",B),function(){null==I||I.off("dm",B)}}),[I,B]),(0,c.useEffect)((function(){1===(null==O?void 0:O.length)&&setTimeout((function(){var e;null===(e=z.current)||void 0===e||e.scrollToBottom()}),100)}),[O]),!o||!i)return null;var R=(0,k.Z)(O?O.flat().reverse():[]);return c.createElement(a.Z,null,c.createElement(m,null,c.createElement(v,null,c.createElement("img",{src:u().url(o.email,{s:"24px",d:"retro"}),alt:o.nickname}),c.createElement("span",null,o.nickname)),c.createElement(y.Z,{chatSections:R,ref:z,setSize:A,isReachingEnd:_}),c.createElement(b.Z,{chat:h,onChangeChat:x,onSubmitForm:P})))}}}]);