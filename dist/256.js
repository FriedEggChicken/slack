"use strict";(self.webpackChunksleact_ts_front=self.webpackChunksleact_ts_front||[]).push([[256],{65256:(e,n,t)=>{t.r(n),t.d(n,{default:()=>T});var a,r,l,o=t(92309),c=t(32545),i=t(79250),s=t(38678),u=t(32951),f=t(5996);function d(e,n){return n||(n=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(n)}}))}var p=f.Z.div(a||(a=d(["\n  display: flex;\n  flex-wrap: wrap;\n  height: calc(100vh - 38px);\n  flex-flow: column;\n  position: relative;\n"]))),h=f.Z.header(r||(r=d(["\n  height: 64px;\n  display: flex;\n  width: 100%;\n  --saf-0: rgba(var(--sk_foreground_low, 29, 28, 29), 0.13);\n  box-shadow: 0 1px 0 var(--saf-0);\n  padding: 20px 16px 20px 20px;\n  font-weight: bold;\n  align-items: center;\n  \n  & .header-right {\n    display: flex;\n    flex: 1;\n    justify-content: flex-end;\n    align-items: center;\n"]))),m=f.Z.div(l||(l=d(["\n  position: absolute;\n  top: 64px;\n  left: 0;\n  width: 100%;\n  height: calc(100% - 64px);\n  background: white;\n  opacity: 0.7;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 40px;\n"]))),g=t(83564),v=t(18667),b=t(9669),w=t.n(b),y=t(67294),k=t(5977),x=t(95591),C=t(44593),Z=t(42867);function _(e,n){return function(e){if(Array.isArray(e))return e}(e)||function(e,n){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var a,r,l,o,c=[],i=!0,s=!1;try{if(l=(t=t.call(e)).next,0===n){if(Object(t)!==t)return;i=!1}else for(;!(i=(a=l.call(t)).done)&&(c.push(a.value),c.length!==n);i=!0);}catch(e){s=!0,r=e}finally{try{if(!i&&null!=t.return&&(o=t.return(),Object(o)!==o))return}finally{if(s)throw r}}return c}}(e,n)||function(e,n){if(e){if("string"==typeof e)return E(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?E(e,n):void 0}}(e,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function E(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,a=new Array(n);t<n;t++)a[t]=e[t];return a}const T=function(){var e,n,t=(0,k.UO)(),a=t.workspace,r=t.channel,l=(0,x.ZP)("/api/users",g.Z).data,f=_((0,s.Z)(""),3),d=f[0],b=f[1],E=f[2],T=(0,x.ZP)("/api/workspaces/".concat(a,"/channels/").concat(r),g.Z).data,S=(0,C.ZP)((function(e){return"/api/workspaces/".concat(a,"/channels/").concat(r,"/chats?perPage=20&page=").concat(e+1)}),g.Z),j=S.data,A=S.mutate,O=S.setSize,D=(0,x.ZP)(l?"/api/workspaces/".concat(a,"/channels/").concat(r,"/members"):null,g.Z).data,I=_((0,u.Z)(a),1)[0],P=0===(null==j||null===(e=j[0])||void 0===e?void 0:e.length)||j&&(null===(n=j[j.length-1])||void 0===n?void 0:n.length)<20||!1,z=(0,y.useRef)(null),B=_((0,y.useState)(!1),2),F=B[0],U=B[1],M=_((0,y.useState)(!1),2),N=M[0],H=M[1],R=(0,y.useCallback)((function(e){if(e.preventDefault(),console.log(d),null!=d&&d.trim()&&j&&T){var n=d;A((function(e){var t;return null==e||e[0].unshift({id:((null===(t=j[0][0])||void 0===t?void 0:t.id)||0)+1,content:n,UserId:l.id,User:l,ChannelId:T.id,Channel:T,createdAt:new Date}),e}),!1).then((function(){var e;E(""),null===(e=z.current)||void 0===e||e.scrollToBottom()})),w().post("/api/workspaces/".concat(a,"/channels/").concat(r,"/chats"),{content:d}).then((function(){A()})).catch(console.error)}}),[d,j,l,T,a,r]),W=(0,y.useCallback)((function(e){e.Channel.name!==r||!e.content.startsWith("uploads\\")&&e.UserId===(null==l?void 0:l.id)||A((function(n){return null==n||n[0].unshift(e),n}),!1).then((function(){var e;z.current&&z.current.getScrollHeight()<z.current.getClientHeight()+z.current.getScrollTop()+150&&(console.log("scrollToBottom!",null===(e=z.current)||void 0===e?void 0:e.getValues()),setTimeout((function(){var e;null===(e=z.current)||void 0===e||e.scrollToBottom()}),50))}))}),[r,l]);(0,y.useEffect)((function(){return null==I||I.on("message",W),function(){null==I||I.off("message",W)}}),[I,W]),(0,y.useEffect)((function(){1===(null==j?void 0:j.length)&&(console.log("toBottomWhenLoaded",z.current),setTimeout((function(){var e;console.log("scrollbar",z.current),null===(e=z.current)||void 0===e||e.scrollToBottom()}),500))}),[j]);var L=(0,y.useCallback)((function(){U(!0)}),[]),V=(0,y.useCallback)((function(){U(!1)}),[]),$=((0,y.useCallback)((function(e){var n=new FormData;if(e.target.files)for(var t=0;t<e.target.files.length;t++){var l=e.target.files[t].getAsFile();console.log("... file["+t+"].name = "+l.name),n.append("image",l)}w().post("/api/workspaces/".concat(a,"/channels/").concat(r,"/images"),n).then((function(){}))}),[]),(0,y.useCallback)((function(e){e.preventDefault(),console.log(e);var n=new FormData;if(e.dataTransfer.items){for(var t=0;t<e.dataTransfer.items.length;t++)if("file"===e.dataTransfer.items[t].kind){var l=e.dataTransfer.items[t].getAsFile();console.log(e,".... file["+t+"].name = "+l.name),n.append("image",l)}}else for(var o=0;o<e.dataTransfer.files.length;o++)console.log(e,"... file["+o+"].name = "+e.dataTransfer.files[o].name),n.append("image",e.dataTransfer.files[o]);w().post("/api/workspaces/".concat(a,"/channels/").concat(r,"/images"),n).then((function(){H(!1)}))}),[a,r])),q=(0,y.useCallback)((function(e){e.preventDefault(),console.log(e),H(!0)}),[]);if(!l)return null;var G=(0,v.Z)(j?j.flat().reverse():[]);return y.createElement(Z.Z,null,y.createElement(p,{onDrop:$,onDragOver:q},y.createElement(h,null,y.createElement("span",null,"#",r),y.createElement("div",{className:"header-right"},y.createElement("span",null,null==D?void 0:D.length),y.createElement("button",{onClick:L,className:"c-button-unstyled p-ia__view_header__button","aria-label":"Add people to #react-native","data-sk":"tooltip_parent",type:"button"},y.createElement("i",{className:"c-icon p-ia__view_header__button_icon c-icon--add-user","aria-hidden":"true"})))),y.createElement(c.Z,{chatSections:G,ref:z,setSize:O,isReachingEnd:P}),y.createElement(o.Z,{chat:d,onChangeChat:b,onSubmitForm:R}),y.createElement(i.Z,{show:F,onCloseModal:V,setShowInviteChannelModal:U}),N&&y.createElement(m,null,"업로드!")))}}}]);